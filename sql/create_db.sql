SET storage_engine=InnoDB;
SET FOREIGN_KEY_CHECKS=1;
DROP DATABASE IF EXISTS registrogrest;
CREATE DATABASE IF NOT EXISTS registrogrest;
USE registrogrest;

DROP TABLE IF EXISTS squadre;
DROP TABLE IF EXISTS bimbo;
DROP TABLE IF EXISTS persone;
DROP TABLE IF EXISTS animatori;
DROP TABLE IF EXISTS programma;
DROP TABLE IF EXISTS giorni;

CREATE TABLE persone (
	PID INT UNSIGNED NOT NULL AUTO_INCREMENT,
	Nome CHAR(30) NOT NULL,
	Cognome CHAR(30) NOT NULL,
	PRIMARY KEY (PID)
);

CREATE TABLE staff_grest (
	SGID INT UNSIGNED NOT NULL AUTO_INCREMENT,
	Nickname CHAR(20) NOT NULL,
	Password CHAR(64) NOT NULL,
	PRIMARY KEY (SGID, Nickname), 
	FOREIGN KEY (SGID)
		REFERENCES persone(PID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE 
);

CREATE TABLE squadre (
	SID INT UNSIGNED NOT NULL AUTO_INCREMENT,
	Nome CHAR(60) NOT NULL,
	Anno SMALLINT NOT NULL,
	PRIMARY KEY (SID)
);

CREATE TABLE animatori (
	AID INT UNSIGNED NOT NULL AUTO_INCREMENT,
	Squadra INT UNSIGNED NOT NULL,
	Anno SMALLINT NOT NULL,
	PRIMARY KEY (AID),
	FOREIGN KEY (Squadra)
		REFERENCES squadre(SID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE,
    FOREIGN KEY (AID)
		REFERENCES persone(PID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE 
);

CREATE TABLE bimbi (
	BID INT UNSIGNED NOT NULL AUTO_INCREMENT,
    Squadra INT UNSIGNED NOT NULL,
	Anno SMALLINT NOT NULL,
	Accompagnatore CHAR(60) NOT NULL,
	PRIMARY KEY (BID),
    FOREIGN KEY (BID)
		REFERENCES persone(PID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE,
    FOREIGN KEY (Squadra)
		REFERENCES squadre(SID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE programma (
	Data DATE NOT NULL,
	Descrizione TEXT,
	OID INT UNSIGNED NOT NULL,
	PRIMARY KEY (Data),
	FOREIGN KEY (OID)
		REFERENCES persone(PID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE giorni (
	Data DATE NOT NULL,
	GID INT UNSIGNED NOT NULL,
	Temperatura DOUBLE(2, 1),
	Assente BIT(1) NOT NULL,
	MotivoAssenza TEXT,
	PRIMARY KEY (Data), 
    FOREIGN KEY (GID)
		REFERENCES persone(PID) 
		ON DELETE CASCADE
		ON UPDATE CASCADE
);